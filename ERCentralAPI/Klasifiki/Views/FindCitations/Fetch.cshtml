@model ReferenceListResult

@{
    ViewData["Title"] = "Fetch";
}
<script type="text/javascript">
    function ShowHideAbstract(id) {
        var row = $('#itemDetailRow-' + id);
        var bt1 = $('#ShowAbstractBt-' + id);
        
        var displrow = row.css('display');
        if (displrow == 'none') {
            //row.css('display', 'table-row');
            row.show(900);
            bt1.text('[Hide Abstract]');
            
        }
        else {
            row.hide(600);
            bt1.text = '[Show Abstract]';
        }

    
    }
    </script>
<form method="post" action="~/FindCitations">
    <input type="hidden" name="ListOfIDs" id="ListOfIDs" value="@Model.ListOfIDs" />
    <input type="hidden" name="SearchString" id="SearchString" value="@Model.SearchString" />
    <input type="hidden" name="SearchMethod" id="SearchMethod" value="@Model.SearchMethod" />

    <button class="btn pull-right p-1" type="submit" value="View Graphs" formaction="ViewGraph">View Graphs</button>
    <h2>Fetch</h2>

    @*<div class="row">
            Your search was
            @{
                if (Model.SearchMethod == "PubMedSearch")
                {<span>a PubMed search.</span>}
                else if (Model.SearchMethod == "PubMedIDs")
                {<span>a search via PubMedIDs.</span>}
            }
        </div>
        <div class="row">
            Your search was:
        </div>
        <div class="row" style="border:1px dotted black; width:100%;">@Model.SearchString.</div>
        <div class="row">Your search returned: @Model.Results.Count.ToString() results.</div>*@

    @Html.Partial("_SearchData.cshtml", Model)




    <table class="table table-hover">
        <thead>
            <tr>
                <th>
                    EPPI-ID
                </th>
                <th>
                    Title <button class="btn-link " type="submit" value="Sort" formaction="SortByTitle">↑↓</button>
                </th>
                @*<th>
                        @Html.DisplayNameFor(model => model.Abstract)
                    </th>*@
                <th>
                    Short Title
                </th>
                <th>
                    Year <button class="btn-link " type="submit" value="Sort" formaction="SortByYear">↑↓</button>
                </th>

                <th>
                    Arrowsmith RCT Score <button class="btn-link " type="submit" value="Sort" formaction="SortByScore">↑↓</button>
                </th>
                <th>
                    Arrowsmith Human-study Score <button class="btn-link " type="submit" value="Sort" formaction="SortByHumanScore">↑↓</button>
                </th>
                <th>
                    PubMed ID
                </th>
                @*<th></th>*@
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Results)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.CitationId)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Title) <span style="font-size:0.5em;">
                        <a onclick="ShowHideAbstract('@Html.Raw(item.CitationId)')" id="@Html.Raw("ShowAbstractBt-"+ item.CitationId)" >[Show Abstract]</a></span>
                    </td>
                    @*<td>
                            @Html.DisplayFor(modelItem => item.Abstract)
                        </td>*@
                    <td>
                        @Html.DisplayFor(modelItem => item.ShortTitle)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.PublicationYear)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Arrowsmith_RCT_Score)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Arrowsmith_Human_Score)
                    </td>
                    <td>
                        @foreach (ExternalID extId in item.ExternalIDs)
                        {

                            if (extId.Name == "pubmed")
                            {@extId.Value;
                        }

                    }
                    </td>
                    @*<td>
                            @Html.ActionLink("Edit", "Edit", new { /* id=item.PrimaryKey */ }) |
                            @Html.ActionLink("Details", "Details", new { /* id=item.PrimaryKey */ }) |
                            @Html.ActionLink("Delete", "Delete", new { /* id=item.PrimaryKey */ })
                        </td>*@
                </tr>

                <tr id="@Html.Raw("itemDetailRow-"+ item.CitationId)" style="display:none;">
                    <td colspan="1">Abstract:</td>
                    <td colspan="6" class="info">
                        @item.Abstract 
                        <span style="font-size:0.5em;">
                            <a onclick="ShowHideAbstract('@Html.Raw(item.CitationId)')" >[Hide Abstract]</a>
                        </span>
                    </td>
                </tr>
            }
        </tbody>
        <br />
        <br />
    </table>
</form>
