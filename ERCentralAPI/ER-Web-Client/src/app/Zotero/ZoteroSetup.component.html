<div class="container col-12" style="min-height:50vh;">
  <div *ngIf="IsServiceBusy" class="k-loading-image" style="position: fixed; top: 2%;"></div>
  <ng-container [ngSwitch]="UIphase">
    <div *ngSwitchCase="'BeginOauthProcess'" class="">
      <ng-container *ngTemplateOutlet="SetupOverview"></ng-container>
      <button class="btn btn-primary p-1 m-1" (click)="BeginOauthProcess()" [disabled]="!CanAskForApiKey">Start Setup</button>
    </div>
    <div *ngSwitchCase="'ViewSettings'">
      <ng-container *ngTemplateOutlet="groupsEtAl"></ng-container>
    </div>
    <div *ngSwitchCase="'PickGroup'">
      Pick Group
      <ng-container *ngTemplateOutlet="groupsEtAl"></ng-container>
    </div>
    <div *ngSwitchCase="'TryAgain'">
      <div class="row mt-1">
        <div class="alert alert-warning border border-danger mx-auto">
          <h4 class="text-center"><span class="k-icon k-i-warning mb-1"></span> Sorry, the authentication attempt failed. <span class="k-icon k-i-warning mb-1"></span></h4>
          <p>
            Sometimes Zotero fails to provide the API-Key needed to access Zotero data on your behalf.<br />
            Why this happens is unclear, but it appears to be random and fairly rare. <br />
            Please <strong>wait one or two minutes</strong> and <strong>try again</strong>.
          </p>
          <p class="mb-1">If the problem persists, please contact EPPISupport.</p>
        </div>
      </div>
      <ng-container *ngTemplateOutlet="SetupOverview"></ng-container>
      <button class="btn btn-primary p-1 m-1" (click)="BeginOauthProcess()" [disabled]="!CanAskForApiKey">Start Setup</button>
    </div>
    <div *ngSwitchCase="'NoGroups'">
      <div class="row mt-1">
        <div class="alert alert-warning border border-danger mx-auto">
          <h4 class="text-center"><span class="k-icon k-i-warning mb-1"></span> Sorry, please try again. <span class="k-icon k-i-warning mb-1"></span></h4>
          <p>
            EPPI-Reviewer could obtain and API Key from Zotero, but the Key does <strong>not grant read and write access to <em>any</em> group library</strong>!<br />
            This could be due to:
          </p>
            <ul>
              <li>
                You may have not created a group, so could not use an API key to provide access.<br />
                (You can click <a href="https://www.zotero.org/groups/" target="_blank">here</a> to see the groups you own.)<br />
                If needed, please click <a href="https://www.zotero.org/groups/new" target="_blank">here</a> to create a new group. (See instructions for point 1 below!)
              </li>
              <li>
                You may have created a group, but didn't create the key with the right permissions.<br />
                If so, please open the instructions for point 3 in a "new tab", so to have them available when in the Zotero page.
              </li>
            </ul>
            <p>Please revise the instructions below and <strong>try again</strong>.</p>
        </div>
      </div>
      <ng-container *ngTemplateOutlet="SetupOverview"></ng-container>
      <button class="btn btn-primary p-1 m-1" (click)="BeginOauthProcess()" [disabled]="!CanAskForApiKey">Start Setup</button>
    </div>
    <div *ngSwitchCase="'ResetAndRestartOauthProcess'">
      <div class="col-12 ">
        <div *ngIf="CurrentUserOwnsTheApiKey;else doesntown ">
          <div>
            You appear to have set-up the Zotero connnection, however, the attempt to verify that the connection is working failed. Perhaps you deleted the "API Key" on
            the Zotero side/website. If that's the case, you will need to <strong>Reset and restart</strong> to setup the connection again. <br />
            If you wish to do so, please click on the "Reset" button below. <br />
            Otherwise, it's possible that your API Key does not provide write access to any group. In such cases (and similar) <strong>please check</strong>
            your API Key settings in the <a href="https://www.zotero.org/settings/keys" target="_blank">Zotero</a> page.
            [The most recently used API Key is probably the one that needs checking.]
          </div>
          <button class="btn btn-danger p-1 m-1" (click)="ResetAndRestart()">Reset</button>
        </div>
      </div>
      <ng-template #doesntown>
        <div>
          <p>
            You appear to have set-up the Zotero connnection, however, the attempt to verify that the connection is working failed. Perhaps the "API Key" was deleted on
            the Zotero side/website. <br />
            Otherwise, it's possible that your API Key does not provide write access to any group. <br />
            In such cases (and similar) <strong>you should ask {{NameOfAPIKeyOwner}}</strong> to login, visit this page, and from here,
            click on the link to <strong>check the API Key</strong> settings.
          </p>
          <p>
            In all cases, you do not own the API Key, and something is wrong, so <strong>{{NameOfAPIKeyOwner}}</strong>
            (who owns the API key) should visit this page to "fix" the current problem.
          </p>
        </div>
      </ng-template>
    </div>
    <div *ngSwitchDefault>
      Unknown Phase - ResetAndRestartOauthProcess?
    </div>
  </ng-container>
  <div style="display:none;">
    <ng-container [ngSwitch]="InstructionsShown">
      <div *ngSwitchCase="'NWcreateGroupLibInZotero'" #InstructionsForNewWindow>
        <ng-container *ngTemplateOutlet="createGroupLibInZotero"></ng-container>
      </div>
      <div *ngSwitchCase="'NWinviteCollaborators'" #InstructionsForNewWindow>
        <ng-container *ngTemplateOutlet="inviteCollaborators"></ng-container>
      </div>
      <div *ngSwitchCase="'NWobtainAPIKey'" #InstructionsForNewWindow>
        <ng-container *ngTemplateOutlet="obtainAPIKey"></ng-container>
      </div>
      <div *ngSwitchDefault></div>
    </ng-container>

  </div>
  <ng-template #groupsEtAl>
    <div class="col-12 row h-100 bg-light">
      <div class="col-12 col-sm-6">
        <h5>Key info</h5>
        <ng-container [ngSwitch]="ErrorMessage">
          <div *ngSwitchCase="''">
            <!--No error message, all is good-->
            <div *ngIf="CurrentUserOwnsTheApiKey">
              You own the API Key. This means that <strong>data pushed to Zotero will contribute to your own "Storage Quota" in Zotero</strong>, and only yours.<br />
              You can click <a href="https://www.zotero.org/settings/storage" target="_blank">Here</a> to check your quota in Zotero. <br />
              If your quota is filling up, you can:
              <ul>
                <li>
                  Purchase more (Zotero) storage
                </li>
                <li>
                  Make up space by deleting references in this or other libraries that sync with the Zotero API (remember to "empty the trash")
                </li>
                <li>
                  Replace the current Key with one created by a collborator. To do so, delete the current key, then ask your collaborator to "Setup" a new API key in here. (They will need to have admin right over this review.)
                </li>
              </ul>
            </div>
            <div *ngIf="!CurrentUserOwnsTheApiKey">
              The API Key is owned by {{NameOfAPIKeyOwner}}. This means that <strong>data pushed to Zotero will contribute to their own "Storage Quota" in Zotero</strong>, and theirs only.<br />
              If you are running out of Zotero storage space, {{NameOfAPIKeyOwner}} may purchase storage there, or perhaps you could agree to re-create the API key so to make it belong to a Zotero user that does have free space.<br />
              You can click <a href="https://www.zotero.org/settings/storage" target="_blank">Here</a> to check <strong>your own</strong> quota in Zotero (which currently does not apply to data coming from EPPI-Reviewer).
            </div>
          </div>
          <div *ngSwitchDefault>
            The current API key (if any) is not valid. Error message is:<br />
            <strong>{{ErrorMessage}}</strong>
          </div>
        </ng-container>
        <div *ngIf="HasAdminRights">
          <button class="btn btn-danger p-1 m-1" (click)="DeleteApiKey()" [disabled]="!HasWriteRights || !CurrentUserOwnsTheApiKey">Delete API Key</button>
        </div>
        <div *ngIf="!HasAdminRights" class="mx-0 px-0 mb-1 row">
          <div class="bg-white rounded border border-info col-auto px-1">
            You do not have admin rights in this review, this page is restricted to "read-only".
          </div>
        </div>
      </div>
      <div class="col-12 col-sm-6">
        <h5>Group Library info</h5>
        <ng-container [ngSwitch]="groupMeta.length">
          <div *ngSwitchCase="0">
            This API Key provides access to zero group libraries.
            <div *ngIf="CurrentUserOwnsTheApiKey">
              You can change the API key setting <a href="https://www.zotero.org/settings/keys" target="_blank">here</a>.<br />
              If you need to <i>first</i> create a Zotero Group Library you can do so <a href="https://www.zotero.org/groups/new" target="_blank">here</a> (<strong>private groups are <i>recommended</i>!</strong>).<br />
              Otherwise you can delete the API Key below and start again.
            </div>
          </div>
          <div *ngSwitchCase="1">
            The current API key provides access to exactly one group (<strong>good!</strong>):
            <div class="row mx-0 px-0">
              <div><strong>Group Id:</strong> {{groupMeta[0].id}}</div>
            </div>
            <div class="row mx-0 px-0">
              <div><strong>Group Name:</strong> {{groupMeta[0].data.name}}</div>
            </div>
            <div class="row mx-0 px-0">
              <strong>Status:</strong>
              <ng-container [ngSwitch]="groupMeta[0].groupBeingSynced">
                <div *ngSwitchCase="true" class="mx-1 row">
                  <div class="mx-auto alert-info border border-info rounded px-2">Active</div>
                </div>
                <div *ngSwitchCase="false" class="mx-1 row">
                  <button class="btn btn-success p-1 mx-auto" (click)="changeGroupBeingSynced(groupMeta[0])" [disabled]="HasAdminRights == false || HasWriteRights == false">Select</button>
                </div>
                <div *ngSwitchDefault>
                  <h4>Unknown</h4>
                </div>
              </ng-container>
            </div>
          </div>
          <div *ngSwitchDefault class="">
            <div *ngIf="ErrorMessage == ''">
              The current API key provides access to multiple groups. You can change what group is currently being used below.<br />
              However, it's usually best to make this decision once and never change it: ideally, <em>one Group Library</em> should be linked to one and only one EPPI-Reviewer review.
            </div>
            <div *ngIf="ErrorMessage == 'No Group Library'">
              The current API key provides access to multiple groups. <strong>You need to pick one group</strong>, ensuring the API key does provide write access to it.<br />
              Please select one group from the list below.
            </div>

            <div *ngIf="ErrorMessage != 'No Group Library' && ErrorMessage !=''">
              The current API key does not seem to work: you need to pick one group library, but the key does not provide access to any group.<br />
              The current "status message" is: <strong>{{ErrorMessage}}</strong>. Please retry:<br />
              <button class="btn btn-danger p-1 m-1" (click)="ResetAndRestart()">Reset</button>
            </div>
            <table class="table table-sm table-bordered table-striped mx-1">
              <thead>
                <tr>
                  <td>
                    <div class="m-1 p-1 ">GroupID</div>
                  </td>
                  <td>
                    <div class="m-1 p-1 ">Group Name</div>
                  </td>
                  <td>
                    <div class="m-1 p-1 ">Version</div>
                  </td>
                  <td>
                    <div class="m-1 p-1 ">Status</div>
                  </td>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of groupMeta; index as i" class="" [ngClass]="{'font-weight-bold': item.groupBeingSynced == true}">
                  <td>
                    {{item.id}}
                  </td>
                  <td class="">{{item.data.name}}</td>
                  <td class="">{{item.version}}</td>
                  <td>
                    <ng-container [ngSwitch]="item.groupBeingSynced">
                      <div *ngSwitchCase="true" class="mx-auto row">
                        <div class="mx-auto alert-info border border-info rounded px-2">Active</div>
                      </div>
                      <div *ngSwitchCase="false" class="mx-auto row">
                        <button class="btn btn-success p-1 mx-auto" (click)="changeGroupBeingSynced(item)">Select</button>
                      </div>
                      <div *ngSwitchDefault>
                        <h4>uh?</h4>
                      </div>
                    </ng-container>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-container>
      </div>
    </div>
  </ng-template>
  <ng-template #groupsEtAlOLD>
    <div class="col-12 col-md-12 px-1 card bg-light">
      <div class=" h-100 w-100">
        <div>
          <div class="col-12 row flex-fill">
            <div class="col-md-5 font-weight-light text-sm-left  align-content-center">
              <h4><b> User Information </b></h4>
            </div>
            <div class="col-md-5 font-weight-light text-sm-left  align-content-center">
              <h4><b> Zotero Groups Information </b></h4>
              <i>(A Zotero shared group must be linked to only one ERWeb review)</i>
            </div>
          </div>
          <div class="col-12 row p-0 mx-1">
            <div class="col-sm-5 col-12 px-1 mb-2 flex-column card alert-primary">
              <div class="font-weight-light text-sm-left ">
                <span class="font-weight-bold"> Current ERWeb Review: </span>{{currentReview}}
              </div>
              <div class="font-weight-light text-sm-left">
                <span class="font-weight-bold">
                  Total items in current review:
                </span> {{totalItemsInCurrentReview}}
              </div>
              <div class="font-weight-light text-sm-left">
                <span class="font-weight-bold">
                  ERWeb UserName:
                </span> {{zoteroUserName}}
              </div>
              <div class="font-weight-light text-sm-left">
                <span class="font-weight-bold">
                  Zotero UserID:
                </span>{{zoteroUserID}}
              </div>
              <div class="font-weight-light text-sm-left">
                <span class="font-weight-bold">
                  Zotero API Key:
                </span> {{zoteroUserKey}}
              </div>

              <div class="font-weight-light text-sm-left ">
                <span class="font-weight-bold">
                  Zotero Storage Limit:
                </span> MB (Not yet implemented)
              </div>

              <div class="font-weight-light text-sm-left ">
                <span class="font-weight-bold">
                  Last Sync Date:
                </span> (Not yet implemented)
              </div>
              <div class="font-weight-light text-sm-left ">
                <span class="font-weight-bold">
                  Service ErrorMessage:
                </span> {{ErrorMessage}}
              </div>
            </div>
            <div class="col-sm-7 col-12 row p-0 m-0 " style="max-height:600px; overflow:auto;">

            </div>
          </div>
          <div class="col-12">
            <div class="col-sm-6 col-12">
              <h4><b> Api Key Information </b></h4>
              <button class="btn btn-danger p-1 m-1" (click)="DeleteApiKey()">Delete Key</button>
              <i>(Only one Zotero api key can be associated to an ERWeb review)</i>
            </div>
            <!--<div class="col-12 col-sm-6 card card-deck fa-border
               alert-primary row p-0 m-0 w-100 p-2 m-2"
                   style="max-height:600px; overflow:auto;" *ngIf="apiKeys.length > 0">
                <table class="table table-bordered table-striped">
                  <thead>
                    <tr>
                      <td>
                        <div class="m-1 p-1 font-weight-light text-sm-left">key</div>

                      </td>
                      <td>
                        <div class="m-1 p-1 font-weight-light text-sm-left">userID</div>

                      </td>
                      <td>
                        <div class="m-1 p-1 font-weight-light text-sm-left">username</div>

                      </td>
                      <td>
                        Remove ApiKey (Removing means re-registering Oauth with Zotero)
                      </td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of apiKeys; index as i" class="small" style="cursor: pointer;">
                      <td class="">{{item.key}}</td>
                      <td class="">{{item.userID}}</td>
                      <td class="">{{item.username}}</td>
                      <td>
                        <button class="btn btn-danger p-1 m-1" (click)="RemoveApiKey(item)">Remove </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>-->
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #SetupOverview>
    <div>
      <p>
        Setting up a link to Zotero <strong>requires attention</strong>, but is normally done only once (per review).<br />
        In Zotero, <strong>Group Libraries</strong> allow to share data with collaborators, which is ideal for shared reviews, but will work equally well for private reviews.
        Thus, EPPI-Reviewer allows to exchange data with Zotero Group Libraries <i>only</i>. This is done by associating <strong>One Review</strong> with <strong>One Group Library</strong>.
        Behind the scenes, this One-To-One relation is made possible by obtaining (and storing) a unique "API Key" from Zotero, which defines EPPI-Reviewer permissions to access a single Group Library.<br />
        [You can, if you wish, create a <strong>Private</strong> group library and include only yourself in it, in case the EPPI-Reviewer data should remain private to you.]
      </p>
      <h5>Setup process summary:</h5>
      <p>Each step requires to make a number of choices, to see the <strong>recommended settings</strong> please click on the "Show me" buttons.</p>
      <ol>
        <li>
          <strong>Before proceeding:</strong> create a Group Library in Zotero (can be done <a href="https://www.zotero.org/groups/new" target="_blank">here</a>).
          <button class="btn btn-sm btn-outline-primary px-1 py-0 mr-1" (click)="InstructionsShown = 'createGroupLibInZotero'">Show me</button>
          <button class="btn btn-sm btn-outline-primary px-1 py-0 mr-1" (click)="ShowInstructionsInNewWindow('NWcreateGroupLibInZotero')">Show me (new tab)</button>
          <div *ngIf="InstructionsShown == 'createGroupLibInZotero'" class="border border-info rounded bg-light col-12 my-1 p-1 mx-0">
            <ng-container *ngTemplateOutlet="createGroupLibInZotero"></ng-container>
          </div>
        </li>
        <li>
          (Optional) Invite collaborators into the Group Library (also done in Zotero).
          <button class="btn btn-sm btn-outline-primary px-1 py-0 mr-1" (click)="InstructionsShown = 'inviteCollaborators'">Show me</button>
          <button class="btn btn-sm btn-outline-primary px-1 py-0 mr-1" (click)="ShowInstructionsInNewWindow('NWinviteCollaborators')">Show me (new tab)</button>
          <div *ngIf="InstructionsShown == 'inviteCollaborators'" class="border border-info rounded bg-light col-12 my-1 p-1 mx-0">
            <ng-container *ngTemplateOutlet="inviteCollaborators"></ng-container>
          </div>
        </li>
        <li>
          Obtain an "API Key", granting EPPI-Reviewer permission to exchange data with Zotero on your behalf.<br />
          Note: <span class="alert-warning">the default permissions offered by Zotero <strong>Will NOT work</strong>, please read and follow the instructions instead.</span>
          <button class="btn btn-sm btn-outline-primary px-1 py-0 ml-1 mr-1" (click)="InstructionsShown = 'obtainAPIKey'">Show me</button>
          <button class="btn btn-sm btn-outline-primary px-1 py-0 mr-1" (click)="ShowInstructionsInNewWindow('NWobtainAPIKey')">Show me (new tab)</button>
          <div *ngIf="InstructionsShown == 'obtainAPIKey'" class="border border-info rounded bg-light col-12 my-1 p-1 mx-0">
            <div style="max-height:50vh; overflow:auto;"><ng-container *ngTemplateOutlet="obtainAPIKey"></ng-container></div>
          </div>
        </li>
        <li>
          Done! If you followed these instructions, EPPI-Reviewer will automatically open the "Sync" tab to move data to/from EPPI-Reviewer/Zotero.
        </li>
      </ol>
    </div>
    <div class="row mx-1 px-1">
      <div class="m-2 border border-primary rounded bg-light p-1 mx-auto">
        <strong>Safety controls</strong><br />
        <div class="border-bottom border-dark">
          <input type="checkbox" [(ngModel)]="SafetyCheck1" class="my-auto mx-1" />
          Yes, I <strong>have created</strong> a Zotero Group Library to exchange data with this review.
        </div>
        <div>
          <input type="checkbox" [(ngModel)]="SafetyCheck2" class="my-auto mx-1" />
          Yes, I <strong>will follow</strong> the instructions (step 3) to set the <strong>correct permissions</strong> on the Zotero side.
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #createGroupLibInZotero>
    <div>
      <p>
        EPPI-Reviewer can be used to exchange data with Zotero group libraries, and <strong>only Group libraries</strong>.
        This is because group libraries can be used to work collaboratively, or not (depending on who you invite in the library),
        thus they allow to extend the collaborative process in Zotero, when required.<br />
        Therefore, <strong>before</strong> you can setup a connection to Zotero, you <strong>need to setup a suitable Group Library</strong>.<br />
        Here is how:
      </p>
      <ol>
        <li>Go to the Zotero <a href="https://www.zotero.org/groups/new" target="_blank">create group library</a> page. (Might ask you to login.)</li>
        <li>Give the new library a name. We recommend to use something like the ReviewID number to make the purpose of the library clear.</li>
        <li>
          Pick a type of Library. Re recommend to use the "<strong>Private Membership</strong>" kind as it's the safer option.<br />
          Options are:
          <ul>
            <li class="alert-danger px-1"><strong><span class="k-icon k-i-cancel k-color-danger mb-1"></span> Public, Open Membership</strong>. We reccomend to <strong>avoid this option</strong> as anyone could edit/delete your data</li>
            <li class="alert-info px-1"><strong>Public, Closed Membership</strong>. This option is safer, although not recommended, as it's not clear what advantages come with making such libraries "public".</li>
            <li class="alert-success px-1"><strong><span class="k-icon k-i-check-outline k-color-success mb-1"></span> Private Membership</strong>. Is the <strong>recommended</strong> option</li>
          </ul>
          Click "<strong>Create Group</strong>".
        </li>
        <li>If you picked the "private" group type, the default settings are ok, giving all group members "Edit" rights; otherwise, customise according to your own needs/plans.</li>
        <li>Click on <strong>Save Settings</strong>. It's all done, you can close the Zotero page, if you wish.</li>
      </ol>
    </div>
    <button (click)="InstructionsShown = ''" class="btn btn-sm btn-outline-dark px-1 py-0 my-1">Close</button>
  </ng-template>
  <ng-template #inviteCollaborators>
    <div>
      <p class="mb-1">
        In case you want to allow collaborators to work on the Group Library you've created, you will need to provide access via the Zotero Group Library page.
        To do so, you'd first need to know their Zotero username(s), or the email address your collaborators have used for their Zotero account.<br />
        <strong>This step is optional and can be done at any time.</strong><br />
        The process is fairly simple:
      </p>
      <ol>
        <li>
          Go to the <a href="https://www.zotero.org/groups" target="_blank">Groups page</a> on the Zotero website.
        </li>
        <li>
          Find the Group you want to use for EPPI-Reviewer data, click on the "<strong>Manage Members</strong>" link for it and then onf the "<strong>Send More Invitations</strong>" link at the bottom.
        </li>
        <li>
          Type in the comma separated list of usernames/emails for the people you wish to invite and click on "Invite Members".
        </li>
      </ol>
      That's it. All done.
    </div>
    <button (click)="InstructionsShown = ''" class="btn btn-sm btn-outline-dark px-1 py-0 my-1">Close</button>
  </ng-template>
  <ng-template #obtainAPIKey>
    <div>
      <p class="mb-1">
        This last step starts in EPPI-Reviewer ("Start setup" button below). However, you will need to
        <strong><span class="k-icon k-i-warning mb-1"></span>change the default settings<span class="k-icon k-i-warning mb-1"></span></strong> in the Zotero page you'll be sent to.<br />
        This is <strong class="alert-warning px-1"><span class="k-icon k-i-warning mb-1"></span>EXTREMELY IMPORTANT<span class="k-icon k-i-warning mb-1"></span></strong>
        as <strong>accepting the default Zotero settings Will Not Work</strong>.<br />
        Step by step instructions:
      </p>
      <ol>
        <li>Tick the two "safety" checkboxes above the "Start setup" button. This is to confirm that you have (1) already created a group library, and (2) read these instructions.</li>
        <li>Click on the "<strong>Start setup</strong>" button, this will send you to a Zotero page, where you might be asked to login.</li>
        <li>
          Click on "Change permissions"<br />
          <img src="assets/Images/ZoteroSetup1.gif" />
        </li>
        <li>
          Ensure that the "Personal Library\Allow library access" option is <strong>NOT ticked</strong>. (This is to protect your personal Zotero data!)<br />
          <img src="assets/Images/ZoteroSetup2.gif" />
        </li>
        <li>
          Tick the "<strong>Specific Groups\Per Group Permissions</strong>" option. This allows to grant access to what's needed and <i>only</i> what's needed.<br />
          <img src="assets/Images/ZoteroSetup3.gif" />
        </li>
        <li>
          Find the Group Library you created to share data with EPPI-Reviewer and <strong>tick the "Read/Write" option</strong>. This allows EPPI-Reviewer to exchange data between the current review and
          <i>only</i> this Group Library.<br />
          <img src="assets/Images/ZoteroSetup4.gif" />
        </li>
        <li>
          Click "<strong>Save Key</strong>" at the bottom of the page.
        </li>
        <li>Zotero will redirect you back to this same EPPI-Reviewer page. Behind the scenes, EPPI-Reviewer will obtain an "API Key" wich will grant it "permissions" to interact with Zotero data, as specified above.</li>
        <li>
          <strong>NOTE:</strong> Sometimes the API-Key obtained by EPPI-Reviewer fails to work. In this case, you will be asked to "<strong>try again</strong>".<br />
          In our experience, it is extremely unlikely that you will need more than 2 or 3 attempts.
        </li>
      </ol>
    </div>
    <button (click)="InstructionsShown = ''" class="btn btn-sm btn-outline-dark px-1 py-0 my-1">Close</button>
  </ng-template>
</div>
