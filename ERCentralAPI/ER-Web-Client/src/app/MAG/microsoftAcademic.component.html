<div class="card p-1 m-1 alert-light" style="min-width: 750px">
  <div class="col-12 row">
    <h5 class="font-weight-bold btn btn-link col-6 pull-left" (click)="FindNewMAGMatches()">
      Look up this record in OpenAlex
    </h5>
    <h5 class="font-weight-bold btn btn-link col-6 pull-right" (click)="ClearMAGMatches()">
      Clear OpenAlex matches from this record
    </h5>
  </div>


  <!--<h5 *ngIf="item"><b>{{item.quickCitation}}</b></h5>-->
  <br />

  <div *ngIf="item">
    <table class="table table-bordered table-responsive-md table-striped text-left small alert-light">

      <tr class="alert-info ">
        <td class="font-weight-bold">Author(s): </td>
        <td colspan="7" class="bg-white">{{item.authors}}</td>
      </tr>
      <tr class="alert-info ">
        <td class="font-weight-bold">Title: </td>
        <td colspan="7" class="bg-white">{{item.title}}</td>
      </tr>
      <tr class="alert-info ">
        <td class="font-weight-bold">Year: </td>
        <td class="bg-white">{{item.year}}</td>
        <td class="font-weight-bold">Journal: </td>
        <td colspan="5" class="bg-white">{{item.parentTitle}}</td>
      </tr>
      <tr class="alert-info ">
        <td class="font-weight-bold">Item ID:</td>
        <td class="bg-white">
          {{item.itemId}}
        </td>
        <td class="font-weight-bold">Volume:</td>
        <td class="bg-white">{{item.volume}}</td>
        <td class="font-weight-bold">Issue:</td>
        <td class="bg-white">{{item.issue}}</td>
        <td class="font-weight-bold">Pages: </td>
        <td class="bg-white">{{item.pages}}</td>
      </tr>
      <tr class="alert-info ">
        <td class="font-weight-bold">DOI: </td>
        <td colspan="7">{{item.doi}}</td>
      </tr>
      <tr>
        <td colspan="8" class="small p-0  bg-info" style="line-height:0.25em;">&nbsp;</td>
      </tr>
    </table>
  </div>



  <h5 class="alert-warning" *ngIf="IsServiceBusy">Loading...</h5>
  <div class="card col-12 alert-light border-dark" style="overflow:auto;"
       *ngIf="_magAdvancedService.MagReferencesPaperList != null && _magAdvancedService.MagReferencesPaperList.papers.length > 0 ">
    <br />

    <b>Matches with OpenAlex records</b>

    <table class="table table-bordered table-responsive-md table-striped text-left small alert-light">
      <tbody>

        <ng-container *ngFor="let magPaper of _magAdvancedService.MagReferencesPaperList.papers">

          <tr class="bg-white">
            <td class="font-weight-bold alert-info">Author(s): </td>
            <td colspan="7" [ngClass]="{'font-weight-bold alert-danger' : item && magPaper.authors.replace(',','').replace(' ','').trim() != item.authors.replace(';','').replace(' ','').trim()}">{{magPaper.authors}}</td>
          </tr>
          <tr class="bg-white">
            <td class="font-weight-bold alert-info">Title: </td>
            <td colspan="7" [ngClass]="{'font-weight-bold alert-danger' : item && areTheTitlesDifferent(item.title, magPaper.paperTitle)}">{{magPaper.paperTitle}}</td>
          </tr>
          <tr class="bg-white">
            <td class="font-weight-bold alert-info">Year: </td>
            <td [ngClass]="{'font-weight-bold alert-danger' : item && magPaper.year.toString().trim() != item.year}">{{magPaper.year}}</td>
            <td class="font-weight-bold alert-info">Journal: </td>
            <td colspan="5" [ngClass]="{'font-weight-bold alert-danger' : item && areTheFieldsDifferent(item.parentTitle, magPaper.journal)}">{{magPaper.journal}}</td>
          </tr>
          <tr class="bg-white">
            <td class="font-weight-bold alert-info">OA ID:</td>
            <td class="bg-white">{{magPaper.paperId}}</td>
            <td class="font-weight-bold alert-info">Volume:</td>
            <td [ngClass]="{'font-weight-bold alert-danger' : item && areTheFieldsDifferent(item.volume, magPaper.volume)}">{{magPaper.volume}}</td>
            <td class="font-weight-bold alert-info" bg-light>Issue:</td>
            <td [ngClass]="{'alert-danger font-weight-bold' : item && areTheFieldsDifferent(item.issue, magPaper.issue)}">{{magPaper.issue}}</td>
            <td class="font-weight-bold alert-info" bg-light>Pages: </td>
            <td [ngClass]="{'alert-danger font-weight-bold' : item && areThePagesDifferent(item.pages, magPaper.firstPage, magPaper.lastPage)}">{{GetPages(magPaper)}}</td>
          </tr>
          <tr>

            <td colspan="1">
              Score:
            </td>
            <td colspan="3">
              <div class="col-12 ">
                {{magPaper.autoMatchScore}}
              </div>
            </td>
            <td colspan="1">
              <div class="col-12 ">
                Status:<br />
                CurrentMagPaper: {{magPaper.manualTrueMatch}}
              </div>
            </td>

            <td colspan="3">
              <div class="col-12">

                Correct Match:&nbsp;   &nbsp;<input (click)="UpdateMagPaper(true, magPaper.paperId)"
                                                    type="radio" [value]="true" name="magMatchRadio_{{magPaper.paperId}}"
                                                    [(ngModel)]="magPaper.manualTrueMatch" class="ml-3">
              </div>
              <div class="col-12 ">
                Incorrect Match: <input (click)="UpdateMagPaper(false, magPaper.paperId)"
                                        type="radio" [value]="true" name="magMatchRadio_{{magPaper.paperId}}"
                                        [(ngModel)]="magPaper.manualFalseMatch" class="ml-3">
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="8">
              <table>
                <tr>
                  <td style="padding:0px">
                    <div class="btn btn-sm btn-link text-left" (click)="GetMagPaperRef(magPaper.paperId)">
                      <span style="font-size:small">View in OpenAlex Browser</span>
                    </div>
                  </td>
                  <td style="padding:0px">
                    <div class="btn btn-sm btn-link pull-right">
                      <a href="https://openalex.org/works/W{{magPaper.paperId}}" target="_blank">
                        <span style="font-size:small">View on the internet</span>
                      </a>
                    </div>
                  </td>
                  <td style="padding:0px">
                    <div class="btn btn-sm btn-link text-left" (click)="enrichItemRecord(magPaper.paperId)">
                      <span style="font-size:small">Enrich record with OpenAlex data</span>
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <tr>
            <td colspan="8" class="small p-0  bg-info" style="line-height:0.25em;">&nbsp;</td>
          </tr>

        </ng-container>


      </tbody>
    </table>

    <br />

  </div>




  <div *ngIf="foundMagPaper">

    <table class="table table-bordered table-responsive-md table-striped text-left small alert-light">
      <tbody>

        <ng-container *ngFor="let magPaper of _magAdvancedService.MagReferencesPaperList.papers">

          <tr class="bg-white">
            <td class="font-weight-bold alert-info">Author(s): </td>
            <td colspan="7" [ngClass]="{'font-weight-bold alert-danger' : item && FoundPaper.authors.replace(',','').replace(' ','').trim() != item.authors.replace(';','').replace(' ','').trim()}">{{FoundPaper.authors}}</td>
          </tr>
          <tr class="bg-white">
            <td class="font-weight-bold alert-info">Title: </td>
            <td colspan="7" [ngClass]="{'font-weight-bold alert-danger' : item && areTheTitlesDifferent(item.title, FoundPaper.paperTitle)}">{{FoundPaper.paperTitle}}</td>
          </tr>
          <tr class="bg-white">
            <td class="font-weight-bold alert-info">Year: </td>
            <td [ngClass]="{'font-weight-bold alert-danger' : item && FoundPaper.year.toString().trim() != item.year}">{{FoundPaper.year}}</td>
            <td class="font-weight-bold alert-info">Journal: </td>
            <td colspan="5" [ngClass]="{'font-weight-bold alert-danger' : item && areTheFieldsDifferent(item.parentTitle, FoundPaper.journal)}">{{FoundPaper.journal}}</td>
          </tr>
          <tr class="bg-white">
            <td class="font-weight-bold alert-info">OA ID:</td>
            <td class="bg-white">{{FoundPaper.paperId}}</td>
            <td class="font-weight-bold alert-info">Volume:</td>
            <td [ngClass]="{'font-weight-bold alert-danger' : item && areTheFieldsDifferent(item.volume, FoundPaper.volume)}">{{FoundPaper.volume}}</td>
            <td class="font-weight-bold alert-info" bg-light>Issue:</td>
            <td [ngClass]="{'alert-danger font-weight-bold' : item && areTheFieldsDifferent(item.issue, FoundPaper.issue)}">{{FoundPaper.issue}}</td>
            <td class="font-weight-bold alert-info" bg-light>Pages: </td>
            <td [ngClass]="{'alert-danger font-weight-bold' : item && areThePagesDifferent(item.pages, FoundPaper.firstPage, FoundPaper.lastPage)}">{{FoundPaper.firstPage}}-{{FoundPaper.lastPage}}</td>
          </tr>
          <tr>

            <td colspan="1">
              Score:
            </td>
            <td colspan="3">
              <div class="col-12 ">
                0
              </div>
            </td>
            <td colspan="1">
              <div class="col-12 ">
                Status:  -
              </div>
            </td>

            <td colspan="3">
              <div class="col-12">

                Correct Match:&nbsp;   &nbsp;<input (click)="UpdateMagPaperFound(true)"
                                                    type="radio" [value]="true" name="magMatchRadioFound_{{FoundPaper.paperId}}"
                                                    [(ngModel)]="FoundPaper.manualTrueMatch" class="ml-3">
              </div>
              <div class="col-12 ">
                Incorrect Match: <input (click)="UpdateMagPaperFound(false)"
                                        type="radio" [value]="true" name="magMatchRadioFound_{{FoundPaper.paperId}}"
                                        [(ngModel)]="FoundPaper.manualFalseMatch" class="ml-3">
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="8">
              <table>
                <tr>
                  <td style="padding:0px">
                    <div class="btn btn-sm btn-link text-left" (click)="GetMagPaperRef(magPaper.paperId)">
                      <span style="font-size:small">View in OpenAlex Browser</span>
                    </div>
                  </td>
                  <td style="padding:0px">
                    <div class="btn btn-sm btn-link pull-right">
                      <a href="https://openalex.org/works/W{{magPaper.paperId}}" target="_blank">
                        <span style="font-size:small">View on the internet</span>
                      </a>
                    </div>
                  </td>
                  <td style="padding:0px">
                    <div class="btn btn-sm btn-link text-left" (click)="enrichItemRecord(magPaper.paperId)">
                      <span style="font-size:small">Enrich record with OpenAlex data</span>
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td colspan="8" class="small p-0  bg-info" style="line-height:0.25em;">&nbsp;</td>
          </tr>
        </ng-container>
      </tbody>
    </table>

  </div>



  <div class="col-12 p-2 m-2 row">
    <div class="col-12 text-left">
      <p><b>Look up specific OpenAlex ID:</b></p>
      <input required minlength="4" type="number" id="magPaperId" name="magPaperId" #magPaper="ngModel"
             class="alert text-center border-dark"
             [(ngModel)]="magPaperId" />
      <button (click)="GetMagPaperForPage()" [disabled]="!CanGetMagPaper()" class="btn btn-outline-primary  p-2 m-2">GO</button>
    </div>
    <div class="col-4"></div>
    <div *ngIf="magPaper.invalid && (magPaper.dirty || magPaper.touched) && magPaper.errors"
         class="col-4 alert alert-danger text-center">

      <div *ngIf="magPaper.errors.required">
        magPaperId is required.
      </div>
      <div *ngIf="magPaper.errors.minlength">
        magPaperId must be at least 4 numbers long.
      </div>
    </div>
  </div>
</div>
