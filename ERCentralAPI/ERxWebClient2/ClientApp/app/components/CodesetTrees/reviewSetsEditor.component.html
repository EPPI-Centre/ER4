<HeaderComponent PageTitle="Edit codesets"></HeaderComponent>
<button class="page-link pt-0 pb-1 mb-1 float-right" style="position:absolute; right: 0; z-index:2000;" (click)="BackToMain()">
    Close/back
</button>
<!--<div *ngFor="let type of SetTypes">
    ID: {{type.setTypeId}} - Name: {{type.setTypeName}} - allowed types N: {{type.allowedCodeTypes.length}}
</div>-->
<kendo-splitter orientation="horizontal">
    <kendo-splitter-pane>
        <div class="pane-content">
            <div *ngIf="IsServiceBusy()" class="k-loading-image"></div>
            <div *ngIf="!SetIsSelected() && !AttributeIsSelected()">
                <div class="containsAtoolbar row m-0" style="background-color:#f1f1f8">
                    <kendo-toolbar>
                        <kendo-toolbar-button [text]="'Import Codesets'"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Add CodeSet'" (click)="ShowActivity('AddCodeSet')"></kendo-toolbar-button>
                    </kendo-toolbar>
                </div>
                To Edit a node in the code tree, please select the desired node in the right-hand side tree.
            </div>

            <div *ngIf="SetIsSelected()" class="container pl-0 pr-0">
                <div class="containsAtoolbar row m-0" style="background-color:#f1f1f8">
                    <kendo-toolbar>
                        <kendo-toolbar-button [text]="'Import Codesets'"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Add CodeSet'" (click)="ShowActivity('AddCodeSet')"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Edit CodeSet'" (click)="ShowActivity('EditCodeset')"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Add Child'" (click)="ShowActivity('AddCode')"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Delete CodeSet'"></kendo-toolbar-button>
                    </kendo-toolbar>
                </div>
            </div>
            <div *ngIf="AttributeIsSelected()" class="container pl-0 pr-0">
                <div class="containsAtoolbar row m-0" style="background-color:#f1f1f8">
                    <kendo-toolbar>
                        <kendo-toolbar-button [text]="'Import Codesets'"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Add Codeset'" (click)="ShowActivity('AddCodeSet')"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Edit Code'"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Add Child'" (click)="ShowActivity('AddCode')"></kendo-toolbar-button>
                        <kendo-toolbar-button [text]="'Delete Code'"></kendo-toolbar-button>
                    </kendo-toolbar>
                </div>
            </div>
            <div *ngIf="CurrentNode">
                Name: {{CurrentNode.name}}<br />
            </div>
            <div *ngIf="ActivityPanelName == 'AddCodeSet'" class="container card card-body bg-light">
                <form class="row" #NewCodesetFrom="ngForm">
                    <div class="col-5">
                        <div class="form-group">
                            <label for="Codeset_Type">Codeset Type</label>
                            <select *ngIf="SetTypes" class="col-md-6 form-control" (change)="TypeChanged($event.target.value)" name="Codeset_Type">
                                <option *ngFor="let type of SetTypes" [value]="type.setTypeId" [selected]="type.setTypeId == NewSetSelectedTypeId">
                                    {{type.setTypeName}}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="col-7">
                        <div><strong>Description:</strong></div>
                        <div class="alert alert-light">
                            {{NewSetSelectedTypeDescription}}
                        </div>
                    </div>
                    <div class="form-group col-12">
                        <label for="source_Name">Codeset Name</label>
                        <input type="text" class="form-control" id="SetName"
                               [(ngModel)]="NewReviewSet.set_name" name="set_name"
                               #name="ngModel">
                        <div [hidden]="IsNewSetNameValid()"
                             class="alert alert-danger">
                            Name is required
                        </div>
                    </div>
                    <div class="col-12">
                        Data Entry Mode:
                        <input type="radio" [value]="true" name="NewSetDataEntryModeN" [(ngModel)]="NewReviewSet.codingIsFinal" class="ml-3"><b>&nbsp;Normal</b>
                        <input type="radio" [value]="false" name="NewSetDataEntryModeN" [(ngModel)]="NewReviewSet.codingIsFinal" class="ml-3"><b>&nbsp;Comparison</b>
                    </div>
                    <div class="form-group col-12">
                        <label for="newSetDescription">Description</label>
                        <textarea class="form-control" id="newSetDescription"
                                  [(ngModel)]="NewReviewSet.description" name="newSetDescription" rows="3"></textarea>
                    </div>
                    <div class="col-12">
                        <button type="submit" (click)="CreateNewCodeSet()" class="btn btn-success ml-2 mr-2" [disabled]="!NewCodesetFrom.dirty || !IsNewSetNameValid() || !CanWrite() ">
                            Create
                        </button>
                        <button class="btn btn-outline-secondary ml-1"
                                (click)="CancelActivity()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
            <div *ngIf="ActivityPanelName == 'EditCodeset'" class="container card card-body bg-light">
                EditCodeset...<br />
                <div *ngIf="ShowDeleteCodeset" class="alert alert-danger">
                    <div>Are you sure you want to delete '{{CurrentNode.name}}' and all its codes?</div>
                    <div>This will affect codes you have assigned to <strong>{{appliedCodes}}</strong> items. All this coding will be deleted!</div>
                    <div>
                        <button class="btn btn-outline-secondary ml-1" (click)="HideDeleteCodeset()" style="width:200px;">No</button>
                        <button class="btn btn-danger ml-1" (click)="DoDeleteCodeset()" 
                                [disabled]="!CanWrite() "
                                style="width:80px;">Yes</button>
                    </div>
                </div>
                <form class="row" #EditCodesetFrom="ngForm">
                    <div class="col-5">
                        Codeset Type: {{CurrentNode.subTypeName}}.
                    </div>
                    <div class="form-group col-7 row">
                        <div>Codeset Name</div>
                        <input type="text" class="form-control" id="SetName"
                               [disabled]="!CanWrite()"
                               [(ngModel)]="CurrentNode.set_name" name="set_name"
                               #name="ngModel">
                        <div [hidden]="IsEditingNodeNameValid()"
                             class="alert alert-danger">
                            Name is required
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row">
                            <div class="mt-1">Data Entry Mode: {{CurrentCodesetDataEntryMode}}</div>
                            <button *ngIf="SetTypeCanChangeDataEntryMode()" class="btn btn-outline-danger btn-sm ml-1 mb-1" 
                                    [disabled]="!CanWrite()"
                                    (click)="ShowChangeDataEntryClicked()">Change</button>
                        </div>
                        <div *ngIf="ShowChangeDataEntry" class="alert alert-danger">
                            <div>{{ChangeDataEntryModeMessage}}</div>
                            <button class="btn btn-outline-secondary btn-sm mb-1" (click)="HideChangeDataEntry()">Cancel</button>
                            <div *ngIf="CanChangeDataEntryMode" class="alert alert-light">
                                Yes, change to
                                <button class="btn btn-outline-danger btn-sm ml-1 mr-1" (click)="DoChangeDataEntry()">
                                    {{DestinationDataEntryMode}}
                                </button>
                                mode.
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-12">
                        <label for="newSetDescription">Description</label>
                        <textarea class="form-control" id="newSetDescription" [disabled]="!CanWrite()"
                                  [(ngModel)]="CurrentNode.description" name="newSetDescription" rows="3"></textarea>
                    </div>
                    <div class="col-12">
                        <button type="submit" (click)="UpdateCodeSet()" class="btn btn-success ml-2 mr-2" 
                                [disabled]="!EditCodesetFrom.dirty || !IsEditingNodeNameValid()|| !CanWrite()">
                            Save
                        </button>
                        <button class="btn btn-outline-secondary ml-1"
                                (click)="CancelActivity()">
                            Cancel
                        </button>
                        <button class="btn btn-outline-danger ml-3" (click)="ShowDeleteCodesetClicked()"
                                [disabled]="!CanWrite()">Delete Codeset...</button>
                    </div>
                </form>
                Name: {{CurrentNode.name}}<br />
                Main Type: {{CurrentNode.nodeType}}<br />
                Sub-Type: {{CurrentNode.subTypeName}}<br />
                Description: {{CurrentNode.description}}<br />
            </div>
            </div>

</kendo-splitter-pane>
    <kendo-splitter-pane size="30%">
        <div class="pane-content">
            <codesetTreeEdit #treeEditorComponent [CanChangeSelectedCode]="CanChangeSelectedCode()" [CanWriteAndServicesIdle]="CanWrite()"></codesetTreeEdit>
        </div>
    </kendo-splitter-pane>
</kendo-splitter>
