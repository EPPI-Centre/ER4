<div *ngIf="IsServiceBusy" class="k-loading-image" style="position: fixed; top: 0%;"></div>
<div class="container px-1 col-12 fullBordersInTabs">
    <div class="row">
        <div class="col-5 col-lg-4" style="max-height:60vh; overflow:auto;">
            Reports list
            <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="FetchReports()">
                <i class="fa fa-refresh "></i>
            </button>
            <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="NewReport()">
               New Report
            </button>
            <div *ngFor="let rpt of Reports">
                {{rpt.reportId}} : {{rpt.name}} <button class="btn btn-outline-success px-1 py-0 my-auto" (click)="EditReport(rpt)">Edit</button>
            </div>
        </div>
        <div class="col-7 col-lg-8 row">
            <div *ngIf="EditingReport != null && ShowCreateNew == true" class="row col-12 m-0 p-1">
                <div class="col m-0">
                    Report Name: <input type="text" maxlength="100" [(ngModel)]="EditingReportName" />
                    Report Type: {{EditingReportType}}
                    <select class="form-control mb-1" style="min-width:110px;"
                            [disabled]="!HasWriteRights" [(ngModel)]="EditingReportType">
                        <option value="Question" [selected]="EditingReportType == 'Question'">Question</option>
                        <option value="Answer" [selected]="EditingReportType == 'Answer'">Answer</option>
                    </select>

                </div>
                <button class="btn btn-outline-success px-1 py-0 my-auto" (click)="ShowCreateNew = false" [disabled]="!EditingReportHasChanged">Done</button>
                <button class="btn btn-outline-dark px-1 py-0 my-auto" (click)="ShowCreateNew = false; EditingReport = null">Cancel</button>
            </div>
            <div *ngIf="EditingReport != null && ShowCreateNew == false">
                <div class="row">
                    <div *ngIf="!UpdatingReportName ; else UpdatingReportNameDiv">
                        {{EditingReport.name}} - {{EditingReport.reportType}}
                        <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="UpdatingReportName = true"
                                [disabled]="!HasWriteRights">
                            <i class="fa fa-edit "></i>
                        </button>
                    </div>
                    <ng-template #UpdatingReportNameDiv>
                        Report Name: <input type="text" maxlength="100" [(ngModel)]="EditingReportName" /> - {{EditingReport.reportType}}
                        <button class="btn btn-sm btn-outline-primary my-auto px-1 py-0" (click)="UpdatingReportName = false"
                                [disabled]="!HasWriteRights">
                            Done
                        </button>
                    </ng-template><button class="btn btn-danger my-auto px-1 py-0" (click)="Save()" [disabled]="!EditingReportHasChanged || !HasWriteRights">Save</button>
                    <div *ngIf="EditingReportHasChanged" class="alert-danger small rounded mx-1 my-auto px-1 py-0">You have unsaved changes!!</div>
                    <button class="btn btn-outline-dark my-auto px-1 py-0" (click)="CancelEditing()">Cancel</button>
                    <div *ngIf="selectedNode != null">Selected code:  <span class="font-weight-bold">{{selectedNode.name}}</span></div>
                    <button class="btn btn-outline-success my-auto px-1 py-0" (click)="AddColumn()" [disabled]="!HasWriteRights">Add column</button>
                </div>
                <div class="row">
                    <div *ngFor="let col of EditingReport.columns" class="border border-info">
                        <div class="row mx-1">
                            <div *ngIf="EditingColumnId == null || EditingColumnId !== col.reportColumnId; else EditingColName">
                                <div>Name: {{col.name}}</div>
                                <div class="ml-auto alert-info">
                                    <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="EditColumn(col)"
                                            [disabled]="!HasWriteRights">
                                        <i class="fa fa-edit "></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="AddCodeToColumn(col, selectedNode)"
                                            [disabled]="!CanAddNodeToColumn(col, selectedNode) || !HasWriteRights">
                                        <i class="fa fa-plus-square "></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="MoveColumnLeft(EditingReport, col)"
                                            [disabled]="col.columnOrder == 0 || !HasWriteRights">
                                        <i class='fa fa-arrow-circle-left'></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="MoveColumnRight(EditingReport, col)"
                                            [disabled]="col.columnOrder >= EditingReport.columns.length-1 || !HasWriteRights">
                                        <i class='fa fa-arrow-circle-right'></i>
                                    </button>
                                    Col {{col.columnOrder + 1}}
                                    <button class="btn btn-sm btn-outline-danger my-auto px-1 py-0" (click)="DeleteColumn(col, EditingReport)"
                                            [disabled]="!HasWriteRights">
                                        <i class="fa fa-trash "></i>
                                    </button>
                                </div>
                            </div>
                            <ng-template #EditingColName>
                                <div class="small">
                                    <input type="text" [(ngModel)]="EditingColumnName" maxlength="200" />
                                    <button class="btn btn-sm btn-outline-primary my-auto px-1 py-0" (click)="EditColumn()">
                                        Done
                                    </button>
                                </div>
                            </ng-template>
                        </div>
                       <div class="p-1 m-1 border border-dark"> 
                           Codes in column...
                           <div *ngFor="let code of col.codes" class="m-1 border rounded border-info">
                               {{code.userDefText}}
                               <button class="btn btn-sm btn-outline-success my-auto px-1 py-0" (click)="EditCode(code)"
                                       [disabled]="!HasWriteRights">
                                   <i class="fa fa-edit "></i>
                               </button>
                               <button class="btn btn-sm btn-outline-danger my-auto px-1 py-0" (click)="DeleteColumnCode(code, col)"
                                       [disabled]="!HasWriteRights">
                                   <i class="fa fa-trash "></i>
                               </button>
                               <button class="btn btn-sm btn-outline-success my-auto px-1 py-0 ml-auto" [disabled]="code.codeOrder == 0 || !HasWriteRights" (click)="MoveColumnCodeUp(col, code)">
                                   <i class='fa fa-arrow-circle-up'></i>
                               </button>
                               <button class="btn btn-sm btn-outline-success my-auto px-1 py-0 mx-1" [disabled]="code.codeOrder >= col.codes.length -1 || !HasWriteRights" (click)="MoveColumnCodeDown(col, code)">
                                   <i class='fa fa-arrow-circle-down'></i>
                               </button>
                               <div *ngIf="EditingColumnCodeId != null && EditingColumnCodeId == code.reportColumnCodeId" class="m-1 p-1">
                                   <div>Name: <input type="text" [(ngModel)]="EditingColumnCodeText" maxlength="200" /></div>
                                   <div>Show code names: <input type="checkbox" [(ngModel)]="EditingColumnCodedisplayCode" /></div>
                                   <div>Show infobox text: <input type="checkbox" [(ngModel)]="EditingColumnNamedisplayAdditionalText" /></div>
                                   <div>Show coded text: <input type="checkbox" [(ngModel)]="EditingColumnCodedisplayCodedText" /></div>
                                   <button class="btn btn-sm btn-outline-primary my-auto px-1 py-0 mx-1" (click)="EditCode()">
                                       Done
                                   </button>
                               </div>
                           </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


