<div class="col-12 p-1 m-2 rounded border container border-info" style="min-width:650px; overflow:auto;">
    <div *ngIf="IsServiceBusy()" class="k-loading-image" style="position: fixed; top: 0%; height:100%; max-height:100%"></div>
    <div class="row my-1 mx-0 alert alert-success h4">
        Distribute work, step {{CurrentStep}}. {{CurrentStepName}}.
    </div>
    <div class="col-12 rounded border border-info alert-info m-1 p-1 ">
        This wizard allows to distribute work for an entire coding exercise, all in one go. You will be asked a series of questions pertaining:<br />
        <ol class="pl-4 mb-0">
            <li [ngClass]="{'font-weight-bold' : CurrentStep==1}">
                <div class="row m-0">
                    What items need to be coded
                    <div *ngIf="workAllocationFromWizardCommand.numberOfItemsToAssign > 0" class="small border border-success rounded bg-light ml-1 px-1">
                        N of items: {{ItemsInTheSelectedPot}}
                        | {{workAllocationFromWizardCommand.filterType}}
                        <span *ngIf="workAllocationFromWizardCommand.filterType == 'No code / coding tool filter'">
                            ({{IncludedExcludedText}}, {{workAllocationFromWizardCommand.percentageOfWholePot}}%)
                        </span>
                        <span *ngIf="workAllocationFromWizardCommand.filterType == 'All without any codes from this coding tool' || workAllocationFromWizardCommand.filterType == 'All with any codes from this coding tool'">
                            ({{selectedCodeSetDropDown?.name}}, {{workAllocationFromWizardCommand.percentageOfWholePot}}%)
                        </span>
                        <span *ngIf="workAllocationFromWizardCommand.filterType == 'All with this code' || workAllocationFromWizardCommand.filterType == 'All without this code'">
                            ({{DropdownWithWithoutSelectedCode?.name}}, {{IncludedExcludedText}}, {{workAllocationFromWizardCommand.percentageOfWholePot}}%)
                        </span>
                    </div>
                </div>
            </li>
            <li [ngClass]="{'font-weight-bold' : CurrentStep==2}">
                <div class="row m-0">
                    The coding work itself
                    <div *ngIf="CanSelectAllocationDestination" class="small border border-success rounded bg-light ml-1 px-1">
                        Work on: {{WorkToDoSelectedCodeSet.name}}
                        <span *ngIf="workAllocationFromWizardCommand.peoplePerItem == 1">
                            | One person per item
                        </span>
                        <span *ngIf="workAllocationFromWizardCommand.peoplePerItem > 1">
                            | {{workAllocationFromWizardCommand.peoplePerItem}} people per item
                        </span>
                        <span *ngIf="AllocationsDestination">
                            | create allocation codes in: {{AllocationsDestination.name}}
                        </span>
                    </div>
                </div>
            </li>
            <li [ngClass]="{'font-weight-bold' : CurrentStep==3}">How to distribute the work</li>
        </ol>
    </div>
    <div *ngIf="CurrentStep==1" class="">
        <div class="row my-1 mx-0">
            <div class="col-3">
                1.1. Select items by this criterion:
            </div>
            <div class="col-5">
                <select #AllocateOptionsDropDown class="form-control" name="AllocateOptions"
                        style="min-width: 200px; max-width:720px;" (change)="SetRelevantDropDownValues($event.target.value)">
                    <!--(click)="isCollapsedAllocateOptions = false; isCollapsedCodingTool = false"-->
                    <option *ngFor="let item of AllocateOptions" [value]="item.key"
                            [selected]="item.value == workAllocationFromWizardCommand.filterType">
                        {{item.value}}
                    </option>
                </select>
                <div *ngIf="workAllocationFromWizardCommand.filterType != ''">
                    <div *ngIf="workAllocationFromWizardCommand.filterType == 'No code / coding tool filter'">You will use all {{IncludedExcludedText}} items.</div>
                    <div *ngIf="workAllocationFromWizardCommand.filterType == 'All without any codes from this coding tool' || workAllocationFromWizardCommand.filterType == 'All with any codes from this coding tool'">
                        <div class="col-12" style="">
                            Select Coding Tool:
                        </div>
                        <div ngbDropdown class="col-12 col-sm-10" style="min-width:200px;">
                            <button class="btn btn-outline-secondary dropdown-toggle col-12"
                                    style="min-width: 350px; max-width:720px;"
                                    (click)="isCollapsedAllocateOptions = false;"
                                    id="dropdownBasicCodingTool" ngbDropdownToggle>
                                {{selectedCodeSetDropDown.name}}
                            </button>
                            <div ngbDropdownMenu aria-labelledby="dropdownBasicCodingTool">
                                <button (click)="setCodeSetDropDown(item)"
                                        *ngFor="let item of CodeSets;" class="dropdown-item">
                                    {{item.name}}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="workAllocationFromWizardCommand.filterType == 'All with this code' || workAllocationFromWizardCommand.filterType == 'All without this code'">
                        <div class="col-12">
                            Select code:
                        </div>
                        <div ngbDropdown class="col-12 col-sm-10">
                            <button ngbDropdownAnchor class="btn btn-outline-secondary dropdown-toggle col-12"
                                    id="dropdownTreeRandomAllocate"
                                    style="min-width: 350px; max-width:720px;"
                                    (click)="isCollapsedAllocateOptions = !isCollapsedAllocateOptions;"
                                    [attr.aria-expanded]="!isCollapsedAllocateOptions" aria-controls="collapseCodeTreeWithWithout">
                                {{DropdownWithWithoutSelectedCode?.name}}
                            </button>
                            <div ngbDropdownMenu class="dropdown-menu" id="collapseCodeTreeWithWithout" [ngbCollapse]="!isCollapsedAllocateOptions">
                                <codesetSelector [IsMultiSelect]="false"
                                                 [WhatIsSelectable]="'SetAttribute'" [MaxHeight]="500" #WithOrWithoutCode
                                                 (selectedNodeInTree)="CloseCodeDropDownCodeWithWithout()"></codesetSelector>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                The list of options allows to identify the items you need to work on in several ways.
                If you none of the options are suitable, you may need to create a new code for this purpose (in and Administration coding tool),
                generate your desired list of items and then assign the whole list to this new code.
            </div>
        </div>
        <div class="row my-1 mx-0 border-top" [ngClass]="{'DisabledStep' : !SelectionCriteriaIsValid}">
            <div class="col-3">
                1.2. Included or Excluded?
            </div>
            <div class="col-5">
                <div class="col-12 row justify-content-center justify-content-md-start m-1">
                    <input class="mt-1 mr-1 ml-sm-4" type="radio" [disabled]="!SelectionCriteriaIsValid" [value]="true" (click)="ClearPot()" [(ngModel)]="workAllocationFromWizardCommand.included">
                    <div class="mr-2">Included</div>
                    <input class="mt-1 mr-1" type="radio" [value]="false" [disabled]="!SelectionCriteriaIsValid" (click)="ClearPot()" [(ngModel)]="workAllocationFromWizardCommand.included">
                    <div class="mr-2">Excluded</div>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                Given the criterion above, limit your selection to items with the "I" (Include) or "E" (Exclude) flag?
            </div>
        </div>
        <div class="row my-1 mx-0 border-top" [ngClass]="{'DisabledStep' : !SelectionCriteriaIsValid}">
            <div class="col-3">
                1.3. Percentage of references?
            </div>
            <div class="col-5 row m-0">
                <div>
                    <kendo-numerictextbox [(ngModel)]="workAllocationFromWizardCommand.percentageOfWholePot"
                                          [disabled]="!SelectionCriteriaIsValid"
                                          [min]="1" [format]="'n0'"
                                          [max]="100"
                                          [step]="1"
                                          [autoCorrect]="true"
                                          (valueChange)="ClearPot()"
                                          class="border border-dark rounded mt-1"
                                          style="width: 100px;">
                    </kendo-numerictextbox>
                    <button class=" ml-2 mt-1 rounded  btn btn-outline-primary" style="min-width:70px" [disabled]="!SelectionCriteriaIsValid" (click)="GetPreviewOrDoit(1)">
                        Preview
                    </button>
                </div>
                <div class="align-self-center ml-2" *ngIf="workAllocationFromWizardCommand.numberOfItemsToAssign >= 0">Corresponding to <b>{{ItemsInTheSelectedPot}} items</b></div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                Given the criteria so far, will you use all the items thus identified or only a percentage? In order to proceed, you <b>must click "preview"</b>, so to get the exact number of items you'll be using.
            </div>
        </div>
        <div class="row justify-content-center mx-0">
            <button class=" pt-1 m-1 btn btn-success" style="min-width:100px" [disabled]="!CanGoToStep2()" (click)="NextStep()">
                Next
            </button>
            <button class=" pt-1 m-1 btn btn-outline-dark " (click)="Cancel()" style="min-width:100px">
                Cancel
            </button>
        </div>
    </div>







    <div *ngIf="CurrentStep==2" class="">
        <div class="row my-1 mx-0 border-top">
            <div class="col-3">
                2.1. Coding tool used for the coding round.
            </div>
            <div class="col-5">
                <div ngbDropdown class="col-12 col-sm-10">
                    <div ngbDropdown class="col-12 col-sm-10" style="min-width:200px;">
                        <button class="btn btn-outline-secondary dropdown-toggle col-12"
                                style="min-width: 350px; max-width:720px;"
                                (click)="isCollapsedAllocateOptions = false;"
                                id="dropdownBasicCodingTool" ngbDropdownToggle>
                            {{WorkToDoSelectedCodeSet.name}}
                        </button>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasicCodingTool">
                            <button (click)="SetWorkToDoCodeSet(item)"
                                    *ngFor="let item of CodeSets;" class="dropdown-item">
                                {{item.name}}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                You can assign coding work to people by specifying which coding tool should be used for the current round. [This is the tool containing the codes that people will be adding to items as part of the work you are assigning.]
            </div>
        </div>
        <div class="row my-1 mx-0 border-top" [ngClass]="{'DisabledStep' : WorkToDoSelectedCodeSet.set_id < 1}">
            <div class="col-3">
                2.2. How many people should code each item?
            </div>
            <div class="col-5 row m-0">
                <div class="col-12 m-0">
                    <kendo-numerictextbox [(ngModel)]="workAllocationFromWizardCommand.peoplePerItem"
                                          [disabled]="WorkToDoSelectedCodeSet.set_id < 1"
                                          [min]="1" [format]="'n0'"
                                          [max]="3"
                                          [step]="1"
                                          [autoCorrect]="true"
                                          (valueChange)="PeoplePerItemChanged()"
                                          class="border border-dark rounded mt-1"
                                          style="width: 90px;">
                    </kendo-numerictextbox>
                </div>
                <div *ngIf="WorkToDoSelectedCodeSet.set_id < 1" class="alert-danger rounded row col-12 m-1">No Coding tool Selected</div>
                <div *ngIf="WorkToDoSelectedCodeSet.set_id >= 1 && (WorkToDoSelectedCodeSet.codingIsFinal && workAllocationFromWizardCommand.peoplePerItem == 1)"
                     class="alert-success  rounded row col-12 m-1">
                    Selected set is in normal coding: one person per item is appropriate.
                </div>
                <div *ngIf="WorkToDoSelectedCodeSet.set_id >= 1 && (WorkToDoSelectedCodeSet.codingIsFinal && workAllocationFromWizardCommand.peoplePerItem != 1)"
                     class="alert-danger rounded row col-12 m-1">
                    <div *ngIf="WorkToDoSelectedCodeSet.setType.setTypeId==6">
                        Selected set is in normal coding: More thant one person per item is not appropriate. Please change the number of people per item to 1, as coding tools of "Administration" type cannot be configured for "Comparison" data-entry mode.
                    </div>
                    <div *ngIf="WorkToDoSelectedCodeSet.setType.setTypeId!=6" class="col-12 m-0 p-0">
                        <div>
                            Selected set is in normal coding: More thant one person per item is not appropriate. Please change the number of people per item, or the Data Entry mode of the coding tool (can be done below).
                        </div>
                        <div class="alert-light border border-danger rounded col-12 small">
                            <div class="mt-1">Change to Data Entry Mode: {{WorkToDoSelectedCodeSetDataEntryM}}</div>
                            <button class="btn btn-outline-danger btn-sm ml-1 mb-1" type="button" *ngIf="!ShowChangeDataEntry"
                                    [disabled]="!CanEditSelectedSet"
                                    (click)="ShowChangeDataEntryClicked()">
                                Change
                            </button>
                            <div *ngIf="ShowChangeDataEntry" class="alert alert-danger">
                                <div>{{ChangeDataEntryModeMessage}}</div>
                                <button class="btn btn-outline-secondary btn-sm mb-1" (click)="HideChangeDataEntry()" type="button">Cancel</button>
                                <div *ngIf="CanChangeDataEntryMode" class="alert alert-light">
                                    Yes, change to
                                    <button class="btn btn-outline-danger btn-sm ml-1 mr-1" type="button"
                                            [disabled]="!CanWrite()" (click)="DoChangeDataEntry()">
                                        {{DestinationDataEntryMode}}
                                    </button>
                                    mode.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="WorkToDoSelectedCodeSet.set_id >= 1 && (!WorkToDoSelectedCodeSet.codingIsFinal && workAllocationFromWizardCommand.peoplePerItem > 1)"
                     class="alert-success  rounded row col-12 m-1">
                    Selected set is in comparison coding: more than one person per item is appropriate.
                </div>
                <div *ngIf="WorkToDoSelectedCodeSet.set_id >= 1 && (!WorkToDoSelectedCodeSet.codingIsFinal && workAllocationFromWizardCommand.peoplePerItem == 1)"
                     class="alert-danger  rounded row col-12 m-1">
                    <div>
                        Selected set is in comparison coding: one person per item is not appropriate. Please change the number of people per item, or the Data Entry mode of the coding tool (can be done below).
                    </div>
                    <div class="alert-light border border-danger rounded col-12 small">
                        <div class="mt-1">Change to Data Entry Mode: {{WorkToDoSelectedCodeSetDataEntryM}}</div>
                        <button class="btn btn-outline-danger btn-sm ml-1 mb-1" type="button" *ngIf="!ShowChangeDataEntry"
                                [disabled]="!CanEditSelectedSet"
                                (click)="ShowChangeDataEntryClicked()">
                            Change
                        </button>
                        <div *ngIf="ShowChangeDataEntry" class="alert alert-danger">
                            <div>{{ChangeDataEntryModeMessage}}</div>
                            <button class="btn btn-outline-secondary btn-sm mb-1" (click)="HideChangeDataEntry()" type="button">Cancel</button>
                            <div *ngIf="CanChangeDataEntryMode" class="alert alert-light">
                                Yes, change to
                                <button class="btn btn-outline-danger btn-sm ml-1 mr-1" type="button"
                                        [disabled]="!CanWrite()" (click)="DoChangeDataEntry()">
                                    {{DestinationDataEntryMode}}
                                </button>
                                mode.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                Single coding or Multiple? You can use this wizard to arrange for a coding (or screening) exercise in which each reference will be coded (or screened) by one, two or three people.
            </div>
        </div>
        <div class="row my-1 mx-0 border-top" [ngClass]="{'DisabledStep' : !CanSelectAllocationDestination}">
            <div class="col-3">
                2.3. Create the required "Allocation groups" here.
            </div>
            <div class="col-5">
                <div class="col-12">
                    Select code:
                </div>
                <div ngbDropdown class="col-12 col-sm-10">
                    <button ngbDropdownAnchor class="btn btn-outline-secondary dropdown-toggle col-12"
                            id="dropdownTreeRandomAllocateTarget"
                            [disabled]="!CanSelectAllocationDestination"
                            style="min-width: 350px; max-width:720px;"
                            (click)="isCollapsedAllocateOptions = !isCollapsedAllocateOptions;"
                            [attr.aria-expanded]="!isCollapsedAllocateOptions" aria-controls="collapseCodeTreeWithWithout">
                        {{AllocationsDestination?.name}}
                    </button>
                    <div ngbDropdownMenu class="dropdown-menu" id="collapseCodeTreeWithWithout" [ngbCollapse]="!isCollapsedAllocateOptions">
                        <codesetSelector [IsMultiSelect]="false"
                                         [WhatIsSelectable]="'RandomAllocation'" [MaxHeight]="500" #DropDownCodeDestination
                                         (selectedNodeInTree)="CloseCodeDropDownCodeDestination()"></codesetSelector>
                    </div>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                This wizard will create some "Administration" codes, which will be used to group together references, in order to drive the required "Coding Assignments".
                For this to happen, you need to pick a place within an administration coding tool, which is where the allocation codes will be placed.
            </div>
        </div>
        <div class="row justify-content-center mx-0">
            <button (click)="PreviousStep()" class=" pt-1 m-1 btn btn-outline-dark " style="min-width:100px">
                Previous
            </button>
            <button class=" pt-1 m-1 btn btn-success" style="min-width:100px" [disabled]="!CanGoToStep3()" (click)="NextStep()">
                Next
            </button>
            <button class=" pt-1 m-1 btn btn-outline-dark " (click)="Cancel()" style="min-width:100px">
                Cancel
            </button>
        </div>
    </div>









    <div *ngIf="CurrentStep==3" class="col-12 p-1 m-0 rounded border container border-info">
        <div class="row my-1 mx-0 border-top">
            <div class="col-2">
                3.1. pick the reviewers. <br />
                (At least {{this.workAllocationFromWizardCommand.peoplePerItem}})
            </div>
            <div class="col-6 row m-0 p-0 ">
                <div *ngIf="Contacts.length > 4" class="col-12">
                    Select All: <input type="checkbox" class="d-inline mr-1" [ngModel]="AllContactsSelected" (click)="SelectAllMembers($event)" />
                </div>
                <div *ngFor="let member of Contacts" class="border border-secondary rounded my-0 mx-1 p-1 " [ngClass]="{'alert-success' : member.IsSelected}">
                    <input type="checkbox" class="d-inline mr-1" [ngModel]="member.IsSelected" (click)="SelectMember(member)" />
                    <div class="d-inline">{{member.contactName}}</div>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                To Assign work, you need to define who will do the work. This wizard will guide you through the process of distributing work across the people you'll select in this step.
            </div>
        </div>
        <div class="row my-1 mx-0 border-top" [ngClass]="{'DisabledStep' : !BarelyEnoughContactsSelected}">
            <div class="col-2">
                3.2. Distribute work evenly?
                <br />
                <!--<div *ngIf="workAllocationFromWizardCommand.peoplePerItem == 1" class="small rounded alert-info">
                Not applicable, all work goes to the same person.
                </div>-->
            </div>
            <div class="col-5">
                <div class="col-12 row justify-content-center m-1">
                    <div class="d-block rounded border border-info m-1">
                        <input class="mt-1 mx-1 d-inline" type="radio" name="Distributeworkevenlyn" [disabled]="!BarelyEnoughContactsSelected"
                               [value]="true" (click)="ResetStep34()" [(ngModel)]="DistributeWorkEvenly">
                        <div class="mr-2 d-inline">Yes</div>
                    </div>
                    <div class="d-block rounded border border-info m-1">
                        <input class="mt-1 mx-1 d-inline" type="radio" name="Distributeworkevenlyn" [disabled]="!CanDistributeUnevenly"
                               [value]="false" (click)="ResetStep34()" [(ngModel)]="DistributeWorkEvenly">
                        <div class="mr-2 d-inline">No</div>
                    </div>
                </div>
            </div>
            <div class="col-5 rounded border border-info alert-info small">
                This wizard can assign all the work automatically, by distributing the same amount references (plus or minus one) to all the people you've picked.
                Otherwise, you can manually assign distinct pots to reviewers.
            </div>
        </div>
        <div class="row my-1 mx-0 border-top" [ngClass]="{'DisabledStep' : !EnoughContactsSelected}">
            <div class="col-2">
                3.3 One group per person or shared groups?
            </div>
            <div class="col-5">
                <div class="col-12 row justify-content-center m-1">
                    <div class="d-block rounded border border-info m-1">
                        <input class="mt-1 mx-1 d-inline" type="radio" [disabled]="!EnoughContactsSelected" name="1groupPerPerson"
                               [value]="false" (click)="WipePreview()" [(ngModel)]="workAllocationFromWizardCommand.oneGroupPerPerson">
                        <div class="mr-2 d-inline">Shared groups</div>
                    </div>
                    <div class="d-block rounded border border-info m-1">
                        <input class="mt-1 mx-1 d-inline" type="radio" [disabled]="!EnoughContactsSelected" name="1groupPerPerson"
                               [value]="true" (click)="WipePreview()" [(ngModel)]="workAllocationFromWizardCommand.oneGroupPerPerson">
                        <div class="mr-2 d-inline">One group per person</div>
                    </div>
                </div>
            </div>
            <div class="col-5 rounded border border-info alert-info small" style="max-height:150px; overflow-y:auto">
                In many cases (when each reference is to be coded by more than one person), it is possible to assign the same work in two different ways.
                (1) You can create one allocation group (an admin code) and a corresponding coding assignment per person
                (each group/assignment will overlap with other groups/assigments).
                (2) Or, you can create "shared" groups, where each group is used to create two or more assignments,
                one for each person who will code the same group of references.<br />
                Strategy (1) can be useful because it minimises the number of coding assignments and makes it easier to follow progress.
                However, it does not make it immediately apparent what comparisons you'll need to create,
                in order to reconcile all items and find all potential disagreements.<br />
                Strategy 2 creates less groups, but many more assignments, making progress somewhat harder to track.
                It has the advantage that the groups created can be used to guide the creation of comparisons,
                as you'll know exactly who got assigned the same batch of references.

            </div>
        </div>
        <div class="row my-1 mx-0 border-top">
            <div class="col-2">
                3.4 Naming the allocation codes.
            </div>
            <div class="col-6">
                Allocation prefix will be:
                <span *ngIf="workAllocationFromWizardCommand.groupsPrefix == ''" class="font-weight-bold">Coding on '{{WorkToDoSelectedCodeSet.name}}'</span>
                <span *ngIf="workAllocationFromWizardCommand.groupsPrefix != ''" class="font-weight-bold">{{workAllocationFromWizardCommand.groupsPrefix}}</span>

                <button class=" pt-1 m-1 rounded btn btn-sm btn-outline-primary " (click)="ShowEditCodesPrefixClicked()">
                    Edit
                </button>
                <div *ngIf="ShowEditCodesPrefix">
                    <input type="text" [(ngModel)]="workAllocationFromWizardCommand.groupsPrefix" />
                    <button class=" pt-1 m-1 rounded btn btn-sm btn-outline-dark " (click)="ShowEditCodesPrefixClicked()">
                        Close
                    </button>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                The wizard will create a number of Allocation Codes, used to group together references and drive Coding Assingments.
                These codes should have meaningful names, to help keeping track of their purpose.
                The system will auto-generate these names, but you may edit their default prefix here.
            </div>
        </div>
        <div class="row my-1 mx-0 border-top">
            <div class="col-2">
                3.4 Details and Preview.
            </div>
            <div class="col-6">
                <div *ngIf="DistributeWorkEvenly" class="row justify-content-center mt-1">
                    <button class=" pt-1 ml-2 rounded  btn btn-outline-primary" style="min-width:70px" [disabled]="!EnoughContactsSelected" (click)="GetPreviewOrDoit(2)">
                        Preview
                    </button>
                </div>
                <div *ngIf="!DistributeWorkEvenly && EnoughContactsSelected" class="col-12 row m-0 p-0">
                    <div class="col-12 row m-0 p-0">
                        <div *ngFor="let member of SelectedContacts" class="border border-secondary rounded my-0 mx-1 p-1 col small" [ngClass]="{'alert-success' : member.NumberOfItems > 0}">
                            <div class="d-inline">{{member.contactName}}</div>
                            <button *ngIf="member.NumberOfItems == 0 && !AllManualAssignmentsDone" class=" px-1 py-0 mx-1 my-0 rounded  btn btn-sm btn-outline-primary" (click)="ShowAddManualMember(member)">
                                Add
                            </button>
                            <div *ngIf="member.NumberOfItems > 0">
                                ({{member.NumberOfItems}})
                            </div>
                        </div>
                    </div>
                    <div class="col-12 row mx-2 my-1 p-2 rounded border border-info ">
                        <div class=""> Number of Items that need to be assigned: <b>{{ToBeManuallyAssignedStill}}</b></div>
                        <button class=" px-1 py-0 mx-1 my-0 btn btn-sm btn-outline-primary" (click)="DistributeRemainingManualAssignTable()">
                            Distribute remaining
                        </button>
                        <button class=" px-1 py-0 mx-1 my-0 btn btn-sm btn-outline-danger" (click)="ResetManualAssignTable()">
                            Reset
                        </button>
                    </div>
                    <div *ngIf="ToAddManualMember != null" class="col-12">
                        Adding <b class="mr-1">{{ToAddManualMember.contactName}}</b>
                        <kendo-numerictextbox #NofItemstoAssigntoPerson
                                              [(ngModel)]="ToAddManualMember.NumberOfItems"
                                              [min]="1" [format]="'n0'"
                                              [max]="workAllocationFromWizardCommand.numberOfItemsToAssign"
                                              [step]="1"
                                              [autoCorrect]="true"
                                              class="border border-dark rounded mt-1"
                                              style="">
                        </kendo-numerictextbox>
                        <button class=" ml-2 mt-1 rounded  btn btn-outline-success" (click)="AddManualMemberToTable()">
                            Add
                        </button>
                        <button class=" ml-2 mt-1 rounded  btn btn-outline-dark" (click)="HideAddManualMember()">
                            Cancel
                        </button>
                    </div>
                    <div *ngIf="ManualAssignTable[0].length > 0" class="col-12 row">
                        <div *ngIf="ManualAssignTable[0].length > 0" class="col">
                            First round<br />
                            <div *ngFor="let member of ManualAssignTable[0]" class="border border-secondary rounded my-0 mx-1 p-1 " [ngClass]="{'alert-success' : member.NumberOfItems > 0}">
                                <div class="d-inline">{{member.contactName}} ({{member.NumberOfItems}} items)</div>
                                <button *ngIf="IsLastInManualAssignTable(member)" class=" px-1 py-0 mx-1 my-0 rounded  btn btn-sm btn-outline-danger" (click)="RemoveLastManualMember()">
                                    Remove
                                </button>
                            </div>
                        </div>
                        <div *ngIf="workAllocationFromWizardCommand.peoplePerItem > 1" class="col">
                            Second round<br />
                            <div *ngFor="let member of ManualAssignTable[1]" class="border border-secondary rounded my-0 mx-1 p-1 " [ngClass]="{'alert-success' : member.NumberOfItems > 0}">
                                <div class="d-inline">{{member.contactName}} ({{member.NumberOfItems}} items)</div>
                                <button *ngIf="IsLastInManualAssignTable(member)" class=" px-1 py-0 mx-1 my-0 rounded  btn btn-sm btn-outline-danger" (click)="RemoveLastManualMember()">
                                    Remove
                                </button>
                            </div>
                        </div>
                        <div *ngIf="workAllocationFromWizardCommand.peoplePerItem > 2" class="col">
                            Third round<br />
                            <div *ngFor="let member of ManualAssignTable[2]" class="border border-secondary rounded my-0 mx-1 p-1 " [ngClass]="{'alert-success' : member.NumberOfItems > 0}">
                                <div class="d-inline">{{member.contactName}} ({{member.NumberOfItems}} items)</div>
                                <button *ngIf="IsLastInManualAssignTable(member)" class=" px-1 py-0 mx-1 my-0 rounded  btn btn-sm btn-outline-danger" (click)="RemoveLastManualMember()">
                                    Remove
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="AllManualAssignmentsDone" class="row sol-12 justify-content-center mt-1 row mx-0 px-0">
                        <button class=" pt-1 ml-2 rounded  btn btn-outline-primary" style="min-width:70px" (click)="GetPreviewOrDoit(2)">
                            Preview
                        </button>
                    </div>
                </div>


                <div *ngIf="WorkAllocWizardResult != null &&  WorkAllocWizardResult.preview != undefined" class="col-12 mt-1" style="max-height:300px;max-width:600px;overflow:auto;">
                    Preview:
                    <table class="table table-sm table-bordered table-striped">
                        <tr *ngFor="let row of WorkAllocWizardResult.preview;let i = index">
                            <td *ngFor="let cell of row" class="small" [ngClass]="{'font-weight-bold alert-info': i== 0}">{{cell}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="col-4 rounded border border-info alert-info small">
                You may now pick the exact details of who will get how many items.
                You <b>must click "preview"</b> in order to double check if your current plan is possible in practice and get a detailed preview of what will happen
                if you clicked "Assign work!".
            </div>
        </div>


        <div class="row justify-content-center mx-0">
            <button (click)="PreviousStep(); ResetStep34();" class=" pt-1 m-1 rounded btn btn-outline-dark " style="min-width:100px">
                Previous
            </button>
            <button class=" pt-1 m-1 rounded  btn btn-success" style="min-width:100px"
                    [disabled]="!(WorkAllocWizardResult != null &&  WorkAllocWizardResult.preview != undefined && WorkAllocWizardResult.isSuccess)"
                    (click)="GetPreviewOrDoit(0)">
                Do it!
            </button>
            <button class=" pt-1 m-1 rounded btn btn-outline-dark" (click)="Cancel()" style="min-width:100px">
                Cancel
            </button>
        </div>
    </div>
</div>









<!--<div  class="card container-fluid mt-1 bg-light  m-1 p-1 form-group">
    <h2>I'm the new wizard, fool!</h2>
    <form class="row" #NewCodeFromCollaborate="ngForm" (ngSubmit)="onSubmit()">
        <div class="col-12">
            <div class="form-group">
                <label for="Codeset_TypeCollaborate">Code Type*</label>
                <select #CodeTypeSelectCollaborate class="form-control" name="NewCode_TypeCollaborate"
                        [disabled]="!CurrentCodeCanHaveChildren">
                    <option *ngFor="let type of _reviewSetsService.AllowedChildTypesOfSelectedNode" [value]="type.key" [selected]="type.key == _reviewSetsService.AllowedChildTypesOfSelectedNode[0].key">
                        {{type.value}}
                    </option>
                </select>
            </div>
        </div>
        <div class="form-group col-12">
            <label for="source_NameCollaborate">Code Name*</label>
            <input type="text" class="form-control" id="AttName" [disabled]="!CurrentCodeCanHaveChildren"
                   [(ngModel)]="NewCode.attribute_name" name="attribute_name"
                   #name="ngModel">
            <span [hidden]="IsNewCodeNameValid()"
                  class="alert alert-danger small p-1">
                Name is required
            </span>
        </div>
        <div class="form-group col-12 mt-2">
            <label for="newSetDescriptionCollaborate">Description (optional)</label>
            <textarea class="form-control" id="newSetDescription" [disabled]="!CurrentCodeCanHaveChildren"
                      [(ngModel)]="NewCode.attribute_set_desc" name="newAttDescription" rows="3"></textarea>
        </div>
        <div class="col-12">
            <button type="submit" (click)="CreateNewCode()"
                    class="btn btn-success ml-2 mr-2"
                    [disabled]="!NewCodeFromCollaborate.dirty || !IsNewCodeNameValid() || !CurrentCodeCanHaveChildren">
                Create
            </button>
            <button class="btn btn-outline-secondary ml-2 mr-2" type="button"
                    (click)="CancelActivity()">
                Cancel
            </button>
        </div>
    </form>
</div>-->


